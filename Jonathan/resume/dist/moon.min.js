/*! moon 21-11-2013 */
var app={sandbox:function(){var a={};return{create:function(b,c){b=b.toLowerCase(),a[b]=c},run:function(b){var c={need:function(b){return b=b.toLowerCase(),a[b]&&a[b].call(c)||void 0}};b.call(c)}}}},modules=app.sandbox(),define=modules.create,main=modules.run;main(function(){function a(a){if(!c[a]){var b=d.need("grammer."+a);b&&(c[a]=b)}}function b(d){var g=!1;if(d.attributes&&d.attributes.length&&Array.prototype.forEach.call(d.attributes,function(b){var h=b.nodeName;a(h),c[h]&&(f.node=d,"repeat"===b.nodeName&&(g=!0),c[h].call(f,b.nodeValue.replace(e,"")))}),e.test(d.nodeValue)){var h=d.nodeValue.replace(e,"");d.nodeValue=f.scope[h],f.eom[h]||(f.eom[h]=[]),f.eom[h].push(d)}d.childNodes&&d.childNodes.length&&!g&&Array.prototype.forEach.call(d.childNodes,function(a){b(a)})}var c={},d=this,e=/^\s*{{\s*|\s*}}\s*$/g,f={scope:{},node:{},eom:{},reg:e};document.addEventListener("DOMContentLoaded",function(){b(document)})}),define("grammer.jbind",function(){function a(a){var b=this.scope;this.node.onkeyup=function(){b[a]=this.value,b.apply()}}return a}),define("grammer.jChange",function(){function a(a){var b=this.scope[a],c=this.scope;this.node.onchange=function(){b.call({},this.value),c.apply()}}return a}),define("grammer.repeat",function(){function a(a){var c=/.*in\s/,d=/\sin.*/,e=/.*\./,f=a.replace(c,"").replace(e,""),g=this.scope[f],h=a.replace(d,""),i=this.node.parentNode,j=i.removeChild(this.node),k=document.createDocumentFragment(),l=this.reg,m=this.eom[f]=[];j.removeAttribute("repeat"),g&&g.length&&(g.forEach(function(a){var c=j.cloneNode(!0),d={};b(l,c,a,h,d),m.push(d),k.appendChild(c)}),i.appendChild(k))}function b(d,e,f,g,h){var i=!1;if(e.attributes&&e.attributes.length&&Array.prototype.forEach.call(e.attributes,function(b){"repeat"===b.nodeName&&(i=!0,c.node=e,c.scope=f,c.reg=d,c.eom=h,a.call(c,b.nodeValue.replace(d,"")))}),d.test(e.nodeValue)){var j=e.nodeValue.replace(d,"").replace(g+".","");e.nodeValue=f[j],h[j]||(h[j]=[]),h[j].push(e)}e.childNodes&&e.childNodes.length&&!i&&Array.prototype.forEach.call(e.childNodes,function(a){b(d,a,f,g,h)})}var c={};return a}),define("grammer.scope",function(){function a(a){this.node.removeAttribute("scope");var e=b.need(a);if(d.isObject(e))e.watch(this.eom),this.scope=e;else if(d.isFunction(e)){var f=new c;this.scope=f,e.call(f),f.watch(this.eom)}}var b=this,c=b.need("core.model"),d=b.need("core.tools");return a}),define("core.model",function(){function a(b,c,d){h(b)||i(b)?k(d[c],function(a){a.nodeValue=b}):f(b)?k(b,function(b,e){a(b,e,d[c][e])}):g(b)&&j(b,function(b,c){a(b,c,d)})}function b(a){for(var b in a)this[b]=a[b],e[b]=a[b]}var c,d=this.need("core.tools"),e={},f=d.isArray,g=d.isObject,h=d.isString,i=d.isNumber,j=d.each,k=d.loop;return b.prototype.apply=function(){j(this,function(b,d){c[d]&&e[d]!==b&&(a(b,d,c),e[d]=b)})},b.prototype.watch=function(a){c=a},b.prototype.inject=function(a){var b=this;j(a,function(c,d){b[d]=a[d]})},b}),define("core.tools",function(){var a={loop:function(a,b){for(var c={},d=0;d<a.length;d++)b.call(c,a[d],d)},each:function(a,b){var c={};for(var d in a)a.hasOwnProperty&&a.hasOwnProperty(d)&&b.call(c,a[d],d)},log:function(){console&&Function.apply.call(console.log,console,arguments)},isArray:function(a){return"[object Array]"===toString.apply(a)},isObject:function(a){return null!==a&&"object"==typeof a},isFunction:function(a){return"function"==typeof a},isString:function(a){return"string"==typeof a},isNumber:function(a){return"number"==typeof a}};return a});